<MudGrid>

  <MudItem xs='12' lg='6'>

    <MudPaper Class="pt-2 ma-2">

      @if (_title is not null)
      {
        <MudText Typo='Typo.h5'>
          @_title
        </MudText>
      }

      <MonacoEditor
        Id="playground-monaco"
        @ref="_sclEditor"
        CssClass='nested-monaco-editor'
        OnDidChangeModelContent='OnDidChangeModelContent'
        ConstructionOptions="SCLEditorConstructionOptions"
      />

      <MudDivider DividerType='DividerType.FullWidth' Class='mt-2' />

      <MudToolBar Dense='true' DisableGutters='true'>
        @if (RunCancellation != null)
        {
          <MudIconButton Icon='@Icons.Material.Filled.Cancel' OnClick="CancelRun"/>
        }
        else
        {
          <MudIconButton Icon='@Icons.Material.Filled.PlayArrow' OnClick="Run"/>
        }
        <MudIconButton Icon='@Icons.Filled.Save' OnClick='SaveSCLFile' Disabled='!_hotChanges'/>
        <MudSpacer/>
        <SettingsMenu Configuration='_configuration' />
      </MudToolBar>

    </MudPaper>

  </MudItem>

  <MudItem xs='12' lg='6'>
    
    <MudTabs Elevation="2"
             Rounded="true"
             ApplyEffectsToContainer="true"
             Class='ma-2'>
      <MudTabPanel Text="Output">
        <MudTextField FullWidth='true'
                      Value="@_consoleStringBuilder.ToString()"
                      ReadOnly="true"
                      Lines="16"
                      AdornmentIcon="@Icons.Material.Filled.Clear"
                      Adornment="Adornment.End"
                      Class='pa-4'
                      DisableUnderLine='true'
                      OnAdornmentClick="() => _consoleStringBuilder.Clear()"/>
      </MudTabPanel>
      <MudTabPanel Text="Log">
        <MudTextField FullWidth='true'
                      Value="@LogText()"
                      ReadOnly="true"
                      Lines="16"
                      AdornmentIcon="@Icons.Material.Filled.Clear"
                      Adornment="Adornment.End"
                      Class='pa-4'
                      DisableUnderLine='true'
                      OnAdornmentClick="@ClearLogs"/>
      </MudTabPanel>
    </MudTabs>
    
  </MudItem>

  @if (_openedFile is not null)
  {
    var constructionOptions = GetFileEditorConstructionOptions(_openedFile);

    <MudItem xs='12' lg='6'>

      <MudPaper Class="pa-4 ma-2" Square="true" Style=''>

        <MudText Typo='Typo.h5'>
          @_openedFile.Path
        </MudText>

        <MonacoEditor
          Id="file-monaco"
          CssClass='nested-monaco-editor'
          @ref="_fileEditor"
          ConstructionOptions="_ => constructionOptions"/>

        <MudIconButton Icon='@Icons.Filled.Save' OnClick='SaveOpenFile'/>
        <MudIconButton Icon='@Icons.Filled.Close' OnClick='CloseOpenFile'/>

      </MudPaper>


    </MudItem>
  }

  <MudItem xs='12'>
    <FileSelection @ref="_fileSelection" FileSystem='FileSystem' OpenFileAction='OpenFileAction'/>
  </MudItem>

</MudGrid>

<MudMessageBox @ref="MudMessageBox" Title="Choose File Name" CancelText="Cancel">
  <MessageContent>
    <MudTextField @bind-Value='_title'/>
  </MessageContent>
  <YesButton>
    <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save">Save</MudButton>
  </YesButton>
</MudMessageBox>

<style>
  .nested-monaco-editor {
    text-align: initial;
    height: 500px;
  }
</style>
