@using System.Web
@inject IJSRuntime Js
@inject NavigationManager Nav

<MudThemeProvider Theme='@Themes.CurrentTheme' DefaultScrollbar='true' />
<MudDialogProvider />
<MudSnackbarProvider />

<Playground IsDarkMode='@IsDarkMode' />

@code {
  [Parameter]
  public bool IsDarkMode { get; set; }

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    try
    {
      if (firstRender)
        await Js.InvokeVoidAsync("onPlaygroundLoad");
    }
    // ignore javascript errors, including if callback not found
    catch (JSException) {}
  }

  protected override void OnParametersSet()
  {
    var query = HttpUtility.ParseQueryString(new UriBuilder(Nav.Uri).Query);
    IsDarkMode = (query["darkMode"] ?? string.Empty).Equals("true", StringComparison.InvariantCultureIgnoreCase);
    Themes.IsDarkMode.OnNext(IsDarkMode);
  }

}
